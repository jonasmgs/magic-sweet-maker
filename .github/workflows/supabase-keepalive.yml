name: Supabase Keep-Alive

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping backend Supabase health
        env:
          BACKEND_HEALTH_URL: ${{ vars.BACKEND_HEALTH_URL }}
        run: |
          BACKEND_HEALTH_URL="$(echo -n "$BACKEND_HEALTH_URL" | tr -d '\r' | xargs)"
          if [ -z "$BACKEND_HEALTH_URL" ]; then
            echo "BACKEND_HEALTH_URL is not set. Add it in repo variables."
            exit 1
          fi
          curl -sS -m 15 -o /dev/null -w "%{http_code}\n" "$BACKEND_HEALTH_URL" | grep -E "^(200|204)$"
